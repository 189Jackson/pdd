import{_ as K,r as P,u as Q}from"./lodash-5ab4a5c9.js";import{a as p,r as b,o as D,f as N,h as o,i as r,w as c,t as h,j as W,k as M,F as X,g as Y,c as Z,n as ee}from"./index-3b707a4f.js";const le={class:"money"},te={class:"money__top"},ae={key:0,style:{"margin-right":"12px"}},ne={class:"money__total"},oe={class:"money__input"},se={style:{color:"red"}},re={style:{color:"blue"}},pe={__name:"index",setup(ue){p(!1);const B=p([]),m=p([]),I=p(),V=p(),x=p(),w=p(),F=p(),C=p(),U=p(),z=p(""),E=p([{label:"娄底",value:1,print:9,page:4,freight:3,cost:0},{label:"山西",value:4,print:10,page:0,freight:4,cost:0},{label:"江苏",value:2,print:8.5,page:1.5,freight:2.5,cost:1},{label:"重庆",value:3,print:9,page:0,freight:3.5,cost:0}]),R=l=>{const e=E.value.find(n=>n.value==z.value);e&&(V.value=e.print,x.value=e.page,w.value=e.freight,F.value=e.cost)},g=l=>l.split("[")[0];function T(l){const e=[30,40,50,60,80,90,100,120];if(typeof l!="number"||isNaN(l))return e[0];for(const n of e)if(l<=n)return n;return e[e.length-1]}const j=()=>{const l=K.cloneDeep(m.value);let e=0,n=0,s=0;const u=[];l.forEach(a=>{const d=a.width/100*(a.height/100)*V.value;let i=Math.min(a.width,a.height)/100*x.value;z.value==2&&(i=parseInt(T(Math.min(a.width,a.height)))/100*x.value);const v=u.some(S=>y(a.address)==y(S.address)&&g(S.name.trim()).trim()==g(a.name.trim()).trim()),_=v?0:w.value,f=v?0:F.value,t=v?0:i;a.isOne=v?0:1;const k=d+t+parseFloat(_)+parseFloat(f);a.total=parseFloat(k).toFixed(5),u.push(a),e+=k,s+=parseFloat(a.isOne),n+=parseFloat(a.isOne)*parseFloat(w.value)}),C.value=s,U.value=n,m.value=l,I.value=parseFloat(e).toFixed(5)};function L(l){try{if(l.length<1)return;B.value=l[0];for(let e=1;e<l.length-1;e++){let n={};for(let s=0;s<l[1].length;s++)n[l[1][s]]=l[e+1][s]??"";m.value.push(n)}console.log("tableData.value",m.value),A()}catch(e){console.error("数据封装失败:",e);return}}const O=()=>{const l=[];m.value.forEach((e,n)=>{const s=G(e.receivingInfo);e.name=s.name.trim(),e.phone=s.phone.trim(),e.address=s.address.trim();const u=l.find(a=>y(e.address)==y((a==null?void 0:a.address)||"")&&g(a==null?void 0:a.name.trim()).trim()==g(e.name.trim()).trim());if(u){e.combine=0;const a=m.value.findIndex(d=>u&&y(u.address)==y(d.address)&&g(u.name.trim())==g(d.name.trim()));m.value[a].combine+=1}else l.push(e),e.combine=1})},$=()=>{m.value.forEach((l,e)=>{const n=q(l.specification),[s,u]=n.split("x");l.width=parseFloat(s.trim()),l.height=parseFloat(u.trim()),l.size=n.trim()})},A=()=>{O(),$()};function q(l){const e=/(\d+\.?\d*)(cm|厘米|米)?\s*[*x]\s*(\d+\.?\d*)(cm|厘米|米)?/i,n=l.match(e);if(!n)return"";const[s,u,a,d,i]=n,v=[a,i].some(f=>f==="米"),_=[a,i].every(f=>!f||["cm","厘米"].includes(f.toLowerCase()));return v||!_?"":`${u}x${d}`}function G(l){const e=/1\d{10}/,n=l.match(e);if(n){const s=n[0],u=l.substring(0,n.index),a=l.substring(n.index+s.length);return{name:u,phone:s,address:a}}else return{name:"",phone:"",address:""}}async function H(l){new FileReader,J(l)}function J(l){let e=new FileReader;e.readAsArrayBuffer(l),e.onload=function(n){try{let s=n.target.result,u=P(s,{type:"binary"});const a=u.Sheets[u.SheetNames[0]],d=Q.sheet_to_json(a,{header:1});L(d)}catch(s){console.error("文件类型不正确或读取失败:",s);return}}}const y=l=>l.split(" ")[0];return(l,e)=>{var _,f;const n=b("el-button"),s=b("el-upload"),u=b("el-option"),a=b("el-select"),d=b("el-input"),i=b("el-table-column"),v=b("el-table");return D(),N("div",le,[o("div",te,[r(s,{action:"","before-upload":H,"http-request":()=>{}},{default:c(()=>[r(n,{type:"primary",size:"small",style:{"margin-right":"6px"}},{default:c(()=>e[5]||(e[5]=[M("导入excel")])),_:1})]),_:1}),(_=m.value)!=null&&_.length?(D(),N("div",ae,h((f=m.value)==null?void 0:f.length)+"条 ",1)):W("",!0),r(n,{type:"danger",size:"small",style:{"margin-left":"40px"},onClick:j},{default:c(()=>e[6]||(e[6]=[M("算 账")])),_:1}),o("div",ne,[o("section",null,[e[7]||(e[7]=o("label",null,"合计",-1)),o("span",null,"￥"+h(I.value),1)]),o("section",null,[e[8]||(e[8]=o("label",null,"快递数量：",-1)),o("span",null,h(C.value)+"个",1)]),o("section",null,[e[9]||(e[9]=o("label",null,"运费合计：",-1)),o("span",null,"￥"+h(U.value),1)])])]),o("div",oe,[r(a,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=t=>z.value=t),size:"small",style:{width:"120px","margin-right":"15px"},placeholder:"选择老板",onChange:R},{default:c(()=>[(D(!0),N(X,null,Y(E.value,t=>(D(),Z(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o("section",null,[e[10]||(e[10]=o("label",null,"打印费",-1)),r(d,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"打印费"},null,8,["modelValue"])]),o("section",null,[e[11]||(e[11]=o("label",null,"运费",-1)),r(d,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"运费"},null,8,["modelValue"])]),o("section",null,[e[12]||(e[12]=o("label",null,"纸筒费",-1)),r(d,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"纸筒费"},null,8,["modelValue"])]),o("section",null,[e[13]||(e[13]=o("label",null,"打包费",-1)),r(d,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=t=>F.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"运费"},null,8,["modelValue"])])]),r(v,{data:m.value,style:{width:"100%",height:"calc(100vh - 130px)"},border:"",size:"small"},{default:c(()=>[r(i,{prop:"",label:"",width:"43"},{default:c(t=>[M(h((t==null?void 0:t.$index)+1),1)]),_:1}),r(i,{prop:"name",label:"收货人姓名",width:"130"},{default:c(t=>[M(h(t.row.name),1)]),_:1}),r(i,{prop:"size",label:"尺寸",width:"120px"},{default:c(t=>[r(d,{size:"small",modelValue:t.row.size,"onUpdate:modelValue":k=>t.row.size=k,style:{width:"90px"},placeholder:"尺寸"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(i,{prop:"size",label:"费用",width:"110px"},{default:c(t=>[o("span",se,h(t.row.total),1)]),_:1}),r(i,{prop:"name",label:"合并订单",width:"80"},{default:c(t=>[o("span",{class:ee(t.row.combine>1?"excel--combine":"")},h(t.row.combine),3)]),_:1}),r(i,{prop:"size",label:"运费数量",width:"80px"},{default:c(t=>[o("span",re,h(t.row.isOne),1)]),_:1}),r(i,{prop:"specification",label:"规格",width:"150"}),r(i,{prop:"receivingInfo",label:"收货信息",width:"200"},{default:c(t=>[o("span",null,h(t.row.receivingInfo),1)]),_:1}),r(i,{prop:"orderId",label:"订单号",width:"160"}),r(i,{prop:"productId",label:"商品Id",width:"120"})]),_:1},8,["data"])])}}};export{pe as default};
