import{_ as P,r as Q,u as M,w as X,F as Z}from"./lodash-5ab4a5c9.js";import{a as b,r as _,o as z,f as S,h as a,i,w as p,t as m,j as ee,E as te,k as V,F as le,g as oe,c as ae,n as j}from"./index-3b707a4f.js";const ne={class:"money"},se={class:"money__top"},re={key:0,style:{"margin-left":"12px"}},ie={class:"money__total"},ue={style:{"font-size":"16px"}},de={class:"money__input"},pe={style:{color:"red"}},ce={style:{color:"red"}},he={style:{color:"red"}},me={style:{color:"red"}},xe={__name:"index",setup(fe){b(!1);const A=b([]),f=b([]),E=b(),w=b(),F=b(),v=b(),B=b(),C=b(),T=b(),N=b("1"),U=b([{label:"计算基数",value:"1",print:9.5,page:4,freight:3,cost:0}]),W=l=>{const e=U.value.find(s=>s.value==N.value);e&&(w.value=e.print,F.value=e.page,v.value=e.freight,B.value=e.cost)};W();const I=()=>{const l=P.cloneDeep(f.value);let e=0,s=0,r=0;const n=2,c=[];l.forEach((o,u)=>{const d=o.width/100*(o.height/100)*w.value*o.num,x=Math.min(o.width,o.height),h=c.some(y=>y.kid==o.kid),t=[x];for(let y=u+1;y<l.length;y++)if(l[y].kid==o.kid){const k=Math.min(l[y].width,l[y].height);t.push(k)}const D=Math.max(...t);o.isOne=h?0:1;let g=0;if(o.custom||o.noSize){const y=h?0:v.value;if(g=parseFloat(o.custom),o.total=Number(parseFloat(g).toFixed(n)),o.freightMoney=Number(y.toFixed(n)),!o.custom){te.alert("请输入自定义金额，亲!","提示",{confirmButtonText:"OK"});return}}else{let y=D/100*F.value;const k=h?0:v.value,J=h?0:B.value,$=h?0:y;o.minWidth=x,o.pageMoney=Number($.toFixed(n)),o.freightMoney=Number(k.toFixed(n)),o.areaMoney=Number(d.toFixed(n)),g=Number(d+$+parseFloat(k)+parseFloat(J)),o.total=Number(parseFloat(g).toFixed(n))}c.push(o),e+=g,r+=parseFloat(o.isOne),s+=parseFloat(o.isOne)*parseFloat(v.value)}),C.value=r,T.value=s,f.value=l,E.value=parseFloat(e).toFixed(n)};function L(l){try{if(l.length<1)return;A.value=l[0];for(let e=1;e<l.length-1;e++){let s={};for(let r=0;r<l[1].length;r++)s[l[1][r]]=l[e+1][r]??"";f.value.push(s)}console.log("tableData.value",f.value),R()}catch(e){console.error("数据封装失败:",e);return}}const O=()=>{f.value.forEach((l,e)=>{const s=K(l.specification),[r,n]=s.split("x");r?(l.width=parseFloat(r.trim()),l.height=parseFloat(n.trim()),l.size=s.trim()):l.noSize=!0})},R=()=>{O(),q()},q=()=>{const l=[];f.value.forEach((e,s)=>{if(l.find(n=>e.kid==n.kid)){e.combine=0;const n=f.value.findIndex(c=>e.kid==c.kid);f.value[n].combine+=1}else l.push(e),e.combine=1})};function K(l){const e=/(\d+\.?\d*)(cm|厘米|米)?\s*[*x-]\s*(\d+\.?\d*)(cm|厘米|米)?/i,s=l.match(e);if(!s)return"";const[r,n,c,o,u]=s,d=[c,u].some(h=>h==="米"),x=[c,u].every(h=>!h||["cm","厘米"].includes(h.toLowerCase()));return d||!x?"":`${n}x${o}`}async function Y(l){new FileReader,G(l)}function G(l){let e=new FileReader;e.readAsArrayBuffer(l),e.onload=function(s){try{let r=s.target.result,n=Q(r,{type:"binary"});const c=n.Sheets[n.SheetNames[0]],o=M.sheet_to_json(c,{header:1});L(o)}catch(r){console.error("文件类型不正确或读取失败:",r);return}}}const H=()=>{const l=[["快递单号","尺寸","打印费","纸筒费","运费","单价","合并订单","订单号","商品规格"]];f.value.forEach((d,x)=>{l.push([d.kid,d.size,d.areaMoney,d.pageMoney,d.freightMoney,d.total,d.combine,d.orderId,d.specification])});const e=M.aoa_to_sheet(l),s=M.book_new();M.book_append_sheet(s,e,"Sheet1");const r=X(s,{bookType:"xlsx",type:"array"}),n=new Date,c=n.getMonth()+1,o=n.getDate();n.getFullYear();const u=new Blob([r],{type:"application/octet-stream"});Z.saveAs(u,`对账单${c}-${o}.xlsx`)};return(l,e)=>{var x,h;const s=_("el-upload"),r=_("el-button"),n=_("el-option"),c=_("el-select"),o=_("el-input"),u=_("el-table-column"),d=_("el-table");return z(),S("div",ne,[a("div",se,[i(s,{action:"",drag:"","before-upload":Y,"http-request":()=>{}},{default:p(()=>e[4]||(e[4]=[a("div",null,"点击或者拖拽excel",-1)])),_:1}),(x=f.value)!=null&&x.length?(z(),S("div",re,m((h=f.value)==null?void 0:h.length)+"条 ",1)):ee("",!0),i(r,{type:"danger",size:"small",style:{"margin-left":"40px"},onClick:I},{default:p(()=>e[5]||(e[5]=[V("算 账")])),_:1}),a("div",ie,[a("section",null,[e[6]||(e[6]=a("label",null,"合计",-1)),a("span",ue,"￥"+m(E.value),1)]),a("section",null,[e[7]||(e[7]=a("label",null,"（ 快递数量：",-1)),a("span",null,m(C.value)+"个",1)]),a("section",null,[e[8]||(e[8]=a("label",null,"运费合计：",-1)),a("span",null,"￥"+m(T.value)+" ）",1)]),i(r,{type:"primary",onClick:H},{default:p(()=>e[9]||(e[9]=[V("导出excel")])),_:1})])]),a("div",de,[i(c,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),size:"small",style:{width:"120px","margin-right":"15px"},placeholder:"选择模板",onChange:W},{default:p(()=>[(z(!0),S(le,null,oe(U.value,t=>(z(),ae(n,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a("section",null,[e[10]||(e[10]=a("label",null,"打印费",-1)),i(o,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"打印费"},null,8,["modelValue"])]),a("section",null,[e[11]||(e[11]=a("label",null,"运费",-1)),i(o,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"运费"},null,8,["modelValue"])]),a("section",null,[e[12]||(e[12]=a("label",null,"纸筒费",-1)),i(o,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=t=>F.value=t),size:"small",type:"number",style:{width:"100px"},placeholder:"纸筒费"},null,8,["modelValue"])])]),i(d,{data:f.value,style:{width:"100%",height:"calc(100vh - 230px)"},border:"",size:"small"},{default:p(()=>[i(u,{prop:"",label:"",width:"43"},{default:p(t=>[V(m((t==null?void 0:t.$index)+1),1)]),_:1}),i(u,{prop:"name",label:"快递单号",width:"160"},{default:p(t=>[V(m(t.row.kid),1)]),_:1}),i(u,{prop:"size",label:"尺寸",width:"120px"},{default:p(t=>[i(o,{size:"small",modelValue:t.row.size,"onUpdate:modelValue":D=>t.row.size=D,style:{width:"90px"},placeholder:"尺寸"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(u,{prop:"size",label:"打印费",width:"90px"},{default:p(t=>[a("span",pe,m(t.row.areaMoney),1)]),_:1}),i(u,{prop:"size",label:"纸筒费",width:"90px"},{default:p(t=>[a("span",ce,m(t.row.pageMoney),1)]),_:1}),i(u,{prop:"size",label:"运费",width:"90px"},{default:p(t=>[a("span",he,m(t.row.freightMoney),1)]),_:1}),i(u,{prop:"size",label:"单价",width:"110px"},{default:p(t=>[a("span",me,m(t.row.total),1)]),_:1}),i(u,{prop:"size",label:"自定义金额",width:"90px"},{default:p(t=>[a("span",null,m(t.row.custom),1)]),_:1}),i(u,{prop:"name",label:"合并订单",width:"80"},{default:p(t=>[a("span",{class:j(t.row.combine>1?"excel--combine":"")},m(t.row.combine),3)]),_:1}),i(u,{prop:"size",label:"数量",width:"60px"},{default:p(t=>[a("span",{class:j(t.row.num>1?"excel--num":"")},m(t.row.num),3)]),_:1}),i(u,{prop:"orderId",label:"订单号",width:"220"}),i(u,{prop:"specification",label:"商品规格",width:"380"})]),_:1},8,["data"])])}}};export{xe as default};
