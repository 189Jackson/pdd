import{_ as H,r as J,u as z,w as P,F as Q}from"./lodash-03d5a44f.js";import{a as f,r as v,o as M,f as S,h as a,i as r,w as p,t as c,j as X,E as Z,k as V,F as ee,g as le,c as te,n as oe,l as ae}from"./index-d2d6a07d.js";const ne={class:"money"},se={class:"money__top"},re={key:0,style:{"margin-left":"12px"}},ie={class:"money__total"},ue={style:{"font-size":"16px"}},de={class:"money__input"},pe={style:{color:"red"}},ce={style:{color:"red"}},he={style:{color:"red"}},me={style:{color:"red"}},_e={__name:"index",setup(fe){f(!1);const $=f([]),h=f([]),E=f(),w=f(),k=f(),g=f(),B=f(),C=f(),N=f(),D=f("1"),T=f([{label:"计算基数",value:"1",print:9.5,page:4,freight:3,cost:0}]),U=t=>{const e=T.value.find(n=>n.value==D.value);e&&(w.value=e.print,k.value=e.page,g.value=e.freight,B.value=e.cost)};U();const j=()=>{const t=H.cloneDeep(h.value);let e=0,n=0,s=0;const u=[];t.forEach((o,m)=>{const i=o.width/100*(o.height/100)*w.value*o.num,d=Math.min(o.width,o.height),b=u.some(_=>_.kid==o.kid),y=[d];for(let _=m+1;_<t.length;_++)if(t[_].kid==o.kid){const F=Math.min(t[_].width,t[_].height);y.push(F)}const l=Math.max(...y);o.isOne=b?0:1;let x=0;if(o.custom||o.noSize){if(x=parseFloat(o.custom),!o.custom){Z.alert("请输入自定义金额，亲!","提示",{confirmButtonText:"OK"});return}}else{let _=l/100*k.value;const F=b?0:g.value,G=b?0:B.value,W=b?0:_;o.minWidth=d,o.pageMoney=W.toFixed(5),o.freightMoney=F.toFixed(5),o.areaMoney=i.toFixed(5),x=i+W+parseFloat(F)+parseFloat(G),o.total=parseFloat(x).toFixed(5)}u.push(o),e+=x,s+=parseFloat(o.isOne),n+=parseFloat(o.isOne)*parseFloat(g.value)}),C.value=s,N.value=n,h.value=t,E.value=parseFloat(e).toFixed(5)};function A(t){try{if(t.length<1)return;$.value=t[0];for(let e=1;e<t.length-1;e++){let n={};for(let s=0;s<t[1].length;s++)n[t[1][s]]=t[e+1][s]??"";h.value.push(n)}console.log("tableData.value",h.value),L()}catch(e){console.error("数据封装失败:",e);return}}const I=()=>{h.value.forEach((t,e)=>{const n=R(t.specification),[s,u]=n.split("x");s?(t.width=parseFloat(s.trim()),t.height=parseFloat(u.trim()),t.size=n.trim()):t.noSize=!0})},L=()=>{I(),O()},O=()=>{const t=[];h.value.forEach((e,n)=>{if(t.find(u=>e.kid==u.kid)){e.combine=0;const u=h.value.findIndex(o=>e.kid==o.kid);h.value[u].combine+=1}else t.push(e),e.combine=1})};function R(t){const e=/(\d+\.?\d*)(cm|厘米|米)?\s*[*x-]\s*(\d+\.?\d*)(cm|厘米|米)?/i,n=t.match(e);if(!n)return"";const[s,u,o,m,i]=n,d=[o,i].some(y=>y==="米"),b=[o,i].every(y=>!y||["cm","厘米"].includes(y.toLowerCase()));return d||!b?"":`${u}x${m}`}async function q(t){new FileReader,K(t)}function K(t){let e=new FileReader;e.readAsArrayBuffer(t),e.onload=function(n){try{let s=n.target.result,u=J(s,{type:"binary"});const o=u.Sheets[u.SheetNames[0]],m=z.sheet_to_json(o,{header:1});A(m)}catch(s){console.error("文件类型不正确或读取失败:",s);return}}}const Y=()=>{const t=[["快递单号","尺寸","打印费","纸筒费","运费","单价","合并订单","订单号","商品规格"]];h.value.forEach((d,b)=>{t.push([d.kid,d.size,d.areaMoney,d.pageMoney,d.freightMoney,d.total,d.combine,d.orderId,d.specification])});const e=z.aoa_to_sheet(t),n=z.book_new();z.book_append_sheet(n,e,"Sheet1");const s=P(n,{bookType:"xlsx",type:"array"}),u=new Date,o=u.getMonth()+1,m=u.getDate();u.getFullYear();const i=new Blob([s],{type:"application/octet-stream"});Q.saveAs(i,`对账单${o}-${m}.xlsx`)};return(t,e)=>{var b,y;const n=v("el-upload"),s=v("el-button"),u=v("el-option"),o=v("el-select"),m=v("el-input"),i=v("el-table-column"),d=v("el-table");return M(),S("div",ne,[a("div",se,[r(n,{action:"",drag:"","before-upload":q,"http-request":()=>{}},{default:p(()=>e[4]||(e[4]=[a("div",null,"点击或者拖拽excel",-1)])),_:1}),(b=h.value)!=null&&b.length?(M(),S("div",re,c((y=h.value)==null?void 0:y.length)+"条 ",1)):X("",!0),r(s,{type:"danger",size:"small",style:{"margin-left":"40px"},onClick:j},{default:p(()=>e[5]||(e[5]=[V("算 账")])),_:1}),a("div",ie,[a("section",null,[e[6]||(e[6]=a("label",null,"合计",-1)),a("span",ue,"￥"+c(E.value),1)]),a("section",null,[e[7]||(e[7]=a("label",null,"（ 快递数量：",-1)),a("span",null,c(C.value)+"个",1)]),a("section",null,[e[8]||(e[8]=a("label",null,"运费合计：",-1)),a("span",null,"￥"+c(N.value)+" ）",1)]),r(s,{type:"primary",onClick:Y},{default:p(()=>e[9]||(e[9]=[V("导出excel")])),_:1})])]),a("div",de,[r(o,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value=l),size:"small",style:{width:"120px","margin-right":"15px"},placeholder:"选择模板",onChange:U},{default:p(()=>[(M(!0),S(ee,null,le(T.value,l=>(M(),te(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a("section",null,[e[10]||(e[10]=a("label",null,"打印费",-1)),r(m,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"打印费"},null,8,["modelValue"])]),a("section",null,[e[11]||(e[11]=a("label",null,"运费",-1)),r(m,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"运费"},null,8,["modelValue"])]),a("section",null,[e[12]||(e[12]=a("label",null,"纸筒费",-1)),r(m,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=l=>k.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"纸筒费"},null,8,["modelValue"])])]),r(d,{data:h.value,style:{width:"100%",height:"calc(100vh - 230px)"},border:"",size:"small"},{default:p(()=>[r(i,{prop:"",label:"",width:"43"},{default:p(l=>[V(c((l==null?void 0:l.$index)+1),1)]),_:1}),r(i,{prop:"name",label:"快递单号",width:"160"},{default:p(l=>[V(c(l.row.kid),1)]),_:1}),r(i,{prop:"size",label:"尺寸",width:"120px"},{default:p(l=>[r(m,{size:"small",modelValue:l.row.size,"onUpdate:modelValue":x=>l.row.size=x,style:{width:"90px"},placeholder:"尺寸"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(i,{prop:"size",label:"打印费",width:"90px"},{default:p(l=>[a("span",pe,c(l.row.areaMoney),1)]),_:1}),r(i,{prop:"size",label:"纸筒费",width:"90px"},{default:p(l=>[a("span",ce,c(l.row.pageMoney),1)]),_:1}),r(i,{prop:"size",label:"运费",width:"90px"},{default:p(l=>[a("span",he,c(l.row.freightMoney),1)]),_:1}),r(i,{prop:"size",label:"单价",width:"110px"},{default:p(l=>[a("span",me,c(l.row.total),1)]),_:1}),r(i,{prop:"size",label:"自定义金额",width:"90px"},{default:p(l=>[a("span",null,c(l.row.custom),1)]),_:1}),r(i,{prop:"name",label:"合并订单",width:"80"},{default:p(l=>[a("span",{class:oe(l.row.combine>1?"excel--combine":"")},c(l.row.combine),3)]),_:1}),r(i,{prop:"size",label:"数量",width:"60px"},{default:p(l=>[a("span",{style:ae({color:l.row.num>1?"#00ff51":""})},c(l.row.num),5)]),_:1}),r(i,{prop:"orderId",label:"订单号",width:"220"}),r(i,{prop:"specification",label:"商品规格",width:"380"})]),_:1},8,["data"])])}}};export{_e as default};
