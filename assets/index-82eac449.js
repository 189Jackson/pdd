import{_ as P,r as Q,u as k,w as X,F as Z}from"./lodash-1da671bb.js";import{a as m,r as _,o as F,f as D,h as a,i as r,w as p,t as f,j as ee,k as M,F as te,g as le,c as oe,n as ae}from"./index-05307c4a.js";const ne={class:"money"},se={class:"money__top"},ie={key:0,style:{"margin-left":"12px"}},re={class:"money__total"},de={style:{"font-size":"16px"}},ue={class:"money__input"},pe={style:{color:"red"}},ce={style:{color:"red"}},he={style:{color:"red"}},me={style:{color:"red"}},ve={__name:"index",setup(fe){m(!1);const j=m([]),c=m([]),S=m(),g=m(),w=m(),x=m(),E=m(),C=m(),B=m(),V=m("1"),N=m([{label:"计算基数",value:"1",print:9.5,page:4,freight:3,cost:0}]),T=t=>{const e=N.value.find(n=>n.value==V.value);e&&(g.value=e.print,w.value=e.page,x.value=e.freight,E.value=e.cost)};T();const A=()=>{const t=P.cloneDeep(c.value);let e=0,n=0,s=0;const i=[];t.forEach((o,h)=>{const d=o.width/100*(o.height/100)*g.value,u=Math.min(o.width,o.height),b=i.some(v=>v.kid==o.kid),y=[u];for(let v=h+1;v<t.length;v++)if(t[v].kid==o.kid){const K=Math.min(t[v].width,t[v].height);y.push(K)}let z=Math.max(...y)/100*w.value;const U=b?0:x.value,J=b?0:E.value,W=b?0:z;o.isOne=b?0:1,o.minWidth=u,o.pageMoney=W.toFixed(5),o.freightMoney=U.toFixed(5),o.areaMoney=d.toFixed(5);const $=d+W+parseFloat(U)+parseFloat(J);o.total=parseFloat($).toFixed(5),i.push(o),e+=$,s+=parseFloat(o.isOne),n+=parseFloat(o.isOne)*parseFloat(x.value)}),C.value=s,B.value=n,c.value=t,S.value=parseFloat(e).toFixed(5)};function I(t){try{if(t.length<1)return;j.value=t[0];for(let e=1;e<t.length-1;e++){let n={};for(let s=0;s<t[1].length;s++)n[t[1][s]]=t[e+1][s]??"";c.value.push(n)}console.log("tableData.value",c.value),O()}catch(e){console.error("数据封装失败:",e);return}}const L=()=>{c.value.forEach((t,e)=>{const n=q(t.specification),[s,i]=n.split("x");t.width=parseFloat(s.trim()),t.height=parseFloat(i.trim()),t.size=n.trim()})},O=()=>{L(),R()},R=()=>{const t=[];c.value.forEach((e,n)=>{if(t.find(i=>e.kid==i.kid)){e.combine=0;const i=c.value.findIndex(o=>e.kid==o.kid);c.value[i].combine+=1}else t.push(e),e.combine=1})};function q(t){const e=/(\d+\.?\d*)(cm|厘米|米)?\s*[*x]\s*(\d+\.?\d*)(cm|厘米|米)?/i,n=t.match(e);if(!n)return"";const[s,i,o,h,d]=n,u=[o,d].some(y=>y==="米"),b=[o,d].every(y=>!y||["cm","厘米"].includes(y.toLowerCase()));return u||!b?"":`${i}x${h}`}async function Y(t){new FileReader,G(t)}function G(t){let e=new FileReader;e.readAsArrayBuffer(t),e.onload=function(n){try{let s=n.target.result,i=Q(s,{type:"binary"});const o=i.Sheets[i.SheetNames[0]],h=k.sheet_to_json(o,{header:1});I(h)}catch(s){console.error("文件类型不正确或读取失败:",s);return}}}const H=()=>{const t=[["快递单号","尺寸","打印费","纸筒费","运费","单价","合并订单","订单号","商品规格"]];c.value.forEach((u,b)=>{t.push([u.kid,u.size,u.areaMoney,u.pageMoney,u.freightMoney,u.total,u.combine,u.orderId,u.specification])});const e=k.aoa_to_sheet(t),n=k.book_new();k.book_append_sheet(n,e,"Sheet1");const s=X(n,{bookType:"xlsx",type:"array"}),i=new Date,o=i.getMonth()+1,h=i.getDate();i.getFullYear();const d=new Blob([s],{type:"application/octet-stream"});Z.saveAs(d,`对账单${o}-${h}.xlsx`)};return(t,e)=>{var b,y;const n=_("el-upload"),s=_("el-button"),i=_("el-option"),o=_("el-select"),h=_("el-input"),d=_("el-table-column"),u=_("el-table");return F(),D("div",ne,[a("div",se,[r(n,{action:"",drag:"","before-upload":Y,"http-request":()=>{}},{default:p(()=>e[4]||(e[4]=[a("div",null,"点击或者拖拽excel",-1)])),_:1}),(b=c.value)!=null&&b.length?(F(),D("div",ie,f((y=c.value)==null?void 0:y.length)+"条 ",1)):ee("",!0),r(s,{type:"danger",size:"small",style:{"margin-left":"40px"},onClick:A},{default:p(()=>e[5]||(e[5]=[M("算 账")])),_:1}),a("div",re,[a("section",null,[e[6]||(e[6]=a("label",null,"合计",-1)),a("span",de,"￥"+f(S.value),1)]),a("section",null,[e[7]||(e[7]=a("label",null,"（ 快递数量：",-1)),a("span",null,f(C.value)+"个",1)]),a("section",null,[e[8]||(e[8]=a("label",null,"运费合计：",-1)),a("span",null,"￥"+f(B.value)+" ）",1)]),r(s,{type:"primary",onClick:H},{default:p(()=>e[9]||(e[9]=[M("导出excel")])),_:1})])]),a("div",ue,[r(o,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),size:"small",style:{width:"120px","margin-right":"15px"},placeholder:"选择模板",onChange:T},{default:p(()=>[(F(!0),D(te,null,le(N.value,l=>(F(),oe(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a("section",null,[e[10]||(e[10]=a("label",null,"打印费",-1)),r(h,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"打印费"},null,8,["modelValue"])]),a("section",null,[e[11]||(e[11]=a("label",null,"运费",-1)),r(h,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"运费"},null,8,["modelValue"])]),a("section",null,[e[12]||(e[12]=a("label",null,"纸筒费",-1)),r(h,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),size:"small",type:"number",style:{width:"100px"},placeholder:"纸筒费"},null,8,["modelValue"])])]),r(u,{data:c.value,style:{width:"100%",height:"calc(100vh - 230px)"},border:"",size:"small"},{default:p(()=>[r(d,{prop:"",label:"",width:"43"},{default:p(l=>[M(f((l==null?void 0:l.$index)+1),1)]),_:1}),r(d,{prop:"name",label:"快递单号",width:"160"},{default:p(l=>[M(f(l.row.kid),1)]),_:1}),r(d,{prop:"size",label:"尺寸",width:"120px"},{default:p(l=>[r(h,{size:"small",modelValue:l.row.size,"onUpdate:modelValue":z=>l.row.size=z,style:{width:"90px"},placeholder:"尺寸"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(d,{prop:"size",label:"打印费",width:"90px"},{default:p(l=>[a("span",pe,f(l.row.areaMoney),1)]),_:1}),r(d,{prop:"size",label:"纸筒费",width:"90px"},{default:p(l=>[a("span",ce,f(l.row.pageMoney),1)]),_:1}),r(d,{prop:"size",label:"运费",width:"90px"},{default:p(l=>[a("span",he,f(l.row.freightMoney),1)]),_:1}),r(d,{prop:"size",label:"单价",width:"110px"},{default:p(l=>[a("span",me,f(l.row.total),1)]),_:1}),r(d,{prop:"name",label:"合并订单",width:"80"},{default:p(l=>[a("span",{class:ae(l.row.combine>1?"excel--combine":"")},f(l.row.combine),3)]),_:1}),r(d,{prop:"orderId",label:"订单号",width:"220"}),r(d,{prop:"specification",label:"商品规格",width:"380"})]),_:1},8,["data"])])}}};export{ve as default};
